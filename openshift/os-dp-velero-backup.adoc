---
sidebar: sidebar 
permalink: openshift/os-dp-velero-backup.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OADP operator, Openshift Data Protection Application operator, Velero 
summary: NetApp ONTAP 통한 Red Hat OpenShift 컨테이너 애플리케이션 데이터 보호 
---
= OpenShift 컨테이너 플랫폼에서 앱에 대한 주문형 백업 생성
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
이 섹션에서는 OpenShift Virtualization에서 VM에 대한 주문형 백업을 생성하는 방법을 설명합니다.



== 앱 백업을 만드는 단계

앱의 주문형 백업(앱 메타데이터 및 앱의 영구 볼륨)을 생성하려면 **백업** 탭을 클릭하여 백업 사용자 정의 리소스(CR)를 생성합니다.  백업 CR을 생성하기 위한 샘플 yaml이 제공됩니다.  이 yaml을 사용하면 앱과 지정된 네임스페이스의 영구 저장소가 백업됩니다.  추가 매개변수는 표시된 대로 설정할 수 있습니다.link:https://docs.openshift.com/container-platform/4.14/backup_and_restore/application_backup_and_restore/backing_up_and_restoring/oadp-creating-backup-cr.html["선적 서류 비치"] .

CSI는 지정된 네임스페이스의 영구 볼륨과 앱 리소스의 스냅샷을 생성합니다.  이 스냅샷은 yaml에 지정된 백업 위치에 저장됩니다.  백업은 TTL에 지정된 대로 30일 동안 시스템에 보관됩니다.

....
spec:
  csiSnapshotTimeout: 10m0s
  defaultVolumesToFsBackup: false
  includedNamespaces:
    - postgresql ->namespace of the app
  itemOperationTimeout: 4h0m0s
  snapshotMoveData: false
  storageLocation: velero-container-backup-ontap-1 -->this is the backupStorageLocation previously created when Velero is configured.
  ttl: 720h0m0s
....
백업이 완료되면 해당 단계가 완료로 표시됩니다.

image:redhat-openshift-oadp-backup-001.png["백업이 완료되었습니다"]

S3 브라우저 애플리케이션을 사용하면 Object Storage에서 백업을 검사할 수 있습니다.  백업 경로는 구성된 버킷에 접두사 이름(velero/container-demo-backup)과 함께 표시됩니다.  백업 내용에는 볼륨 스냅샷, 로그 및 애플리케이션의 기타 메타데이터가 포함되어 있음을 확인할 수 있습니다.


NOTE: StorageGrid에서는 테넌트 관리자에서 제공하는 S3 콘솔을 사용하여 백업 객체를 볼 수도 있습니다.

image:redhat-openshift-oadp-backup-002.png["S3의 백업 객체"]



== 앱에 대한 예약된 백업 생성

일정에 따라 백업을 만들려면 일정 CR을 만들어야 합니다.  일정은 백업을 만들고 싶은 시간을 지정할 수 있게 해주는 Cron 표현식입니다.  일정 CR을 만드는 샘플 YAML은 아래와 같습니다.

....
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: schedule1
  namespace: openshift-adp
spec:
  schedule: 0 7 * * *
  template:
    includedNamespaces:
      - postgresql
    storageLocation: velero-container-backup-ontap-1
....
Cron 표현식 0 7 * * *는 매일 7시에 백업이 생성됨을 의미합니다.  백업에 포함될 네임스페이스와 백업의 저장 위치도 지정됩니다.  따라서 백업 CR 대신 일정 CR을 사용하여 지정된 시간과 빈도로 백업을 생성합니다.

일정이 생성되면 활성화됩니다.

image:redhat-openshift-oadp-backup-003.png["일정이 생성되었습니다"]

백업은 이 일정에 따라 생성되며, 백업 탭에서 볼 수 있습니다.

image:redhat-openshift-oadp-backup-004.png["예약된 백업이 완료되었습니다"]
