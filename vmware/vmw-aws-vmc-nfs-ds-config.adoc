---
sidebar: sidebar 
permalink: vmware/vmw-aws-vmc-nfs-ds-config.html 
keywords:  
summary:  
---
= AWS에서 보충 NFS 데이터 저장소 만들기
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VMware Cloud가 준비되고 AWS VPC에 연결되면 원래 연결되었거나 기존의 기본 VPC가 아닌 새로 지정된 VPC에 Amazon FSx ONTAP 배포해야 합니다.

시작하려면 SDDC가 있는 동일한 지역 및 가용성 영역에 추가 VPC를 배포한 다음 새 VPC에 Amazon FSx ONTAP 배포합니다. https://docs.vmware.com/en/VMware-Cloud-on-AWS/services/com.vmware.vmc-aws-networking-security/GUID-C957DBA7-16F5-412B-BB72-15B49B714723.html["VMware Cloud에서 SDDC 그룹 구성"^] 콘솔은 FSx ONTAP 배포될 새로 지정된 VPC에 연결하는 데 필요한 네트워킹 구성 옵션을 활성화합니다.


NOTE: AWS SDDC의 VMware Cloud와 동일한 가용성 영역에 FSx ONTAP 배포합니다.


NOTE: 연결된 VPC에 FSx ONTAP 배포할 수 없습니다.  대신, 새로운 지정된 VPC에 배포한 다음 SDDC 그룹을 통해 VPC를 VMware Managed Transit Gateway(vTGW)에 연결해야 합니다.

.1단계: 지정된 새 VPC에 Amazon FSx ONTAP 생성
[%collapsible%open]
====
Amazon FSx ONTAP 파일 시스템을 만들고 마운트하려면 다음 단계를 완료하세요.

. Amazon FSx 콘솔을 엽니다. `https://console.aws.amazon.com/fsx/` *파일 시스템 생성*을 선택하여 *파일 시스템 생성* 마법사를 시작합니다.
. 파일 시스템 유형 선택 페이지에서 * Amazon FSx ONTAP*을 선택한 후 *다음*을 클릭합니다.  *파일 시스템 생성* 페이지가 나타납니다.
+
image:fsx-nfs-002.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 생성 방법으로 *표준 생성*을 선택하세요.
+
image:fsx-nfs-003.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+
image:fsx-nfs-004.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 데이터 저장소 크기는 고객마다 상당히 다릅니다.  NFS 데이터 저장소당 권장되는 가상 머신 수는 주관적이지만, 각 데이터 저장소에 배치할 수 있는 최적의 VM 수는 여러 요인에 따라 결정됩니다.  대부분의 관리자는 용량만 고려하지만, VMDK로 전송되는 동시 I/O 양은 전반적인 성능에 가장 중요한 요소 중 하나입니다.  온프레미스의 성능 통계를 사용하여 데이터 저장소 볼륨 크기를 적절히 조정합니다.

. Virtual Private Cloud(VPC)의 *네트워킹* 섹션에서 경로 테이블과 함께 적절한 VPC와 기본 서브넷을 선택합니다.  이 경우 드롭다운 메뉴에서 Demo-FSxforONTAP-VPC가 선택됩니다.
+

NOTE: 이것이 연결된 VPC가 아닌, 새롭고 지정된 VPC인지 확인하세요.

+

NOTE: 기본적으로 FSx ONTAP 파일 시스템의 기본 엔드포인트 IP 주소 범위로 198.19.0.0/16을 사용합니다.  Endpoint IP 주소 범위가 AWS SDDC, 관련 VPC 서브넷 및 온프레미스 인프라의 VMC와 충돌하지 않는지 확인하세요.  확실하지 않은 경우 충돌이 없는 겹치지 않는 범위를 사용하세요.

+
image:fsx-nfs-005.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 암호화 키의 *보안 및 암호화* 섹션에서 파일 시스템의 저장 데이터를 보호하는 AWS Key Management Service(AWS KMS) 암호화 키를 선택합니다.  *파일 시스템 관리 비밀번호*에 fsxadmin 사용자에 대한 안전한 비밀번호를 입력합니다.
+
image:fsx-nfs-006.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *기본 스토리지 가상 머신 구성* 섹션에서 SVM의 이름을 지정합니다.
+

NOTE: GA 기준으로 4개의 NFS 데이터 저장소가 지원됩니다.

+
image:fsx-nfs-007.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *기본 볼륨 구성* 섹션에서 데이터 저장소에 필요한 볼륨 이름과 크기를 지정하고 *다음*을 클릭합니다.  이것은 NFSv3 볼륨이어야 합니다.  *저장소 효율성*에서 *활성화*를 선택하여 ONTAP 저장소 효율성 기능(압축, 중복 제거, 압축)을 켭니다.  생성 후, 다음과 같이 *_volume modify_*를 사용하여 셸을 사용하여 볼륨 매개변수를 수정합니다.
+
[cols="50%, 50%"]
|===
| 환경 | 구성 


| 볼륨 보장(스페이스 보장 스타일) | 없음(씬 프로비저닝) - 기본적으로 설정됨 


| 부분적 준비금(부분적 준비금) | 0% – 기본적으로 설정됨 


| snap_reserve(스냅샷 공간 백분율) | 0% 


| 자동 크기 조정(autosize-mode) | 성장_축소 


| 스토리지 효율성 | 활성화됨 - 기본적으로 설정됨 


| 자동 삭제 | 볼륨 / 가장 오래된_첫 번째 


| 볼륨 티어링 정책 | 스냅샷만 – 기본적으로 설정됨 


| 먼저 시도하세요 | 자동 성장 


| 스냅샷 정책 | None 
|===
+
다음 SSH 명령을 사용하여 볼륨을 만들고 수정하세요.

+
*셸에서 새로운 데이터 저장소 볼륨을 생성하는 명령:*

+
 volume create -vserver FSxONTAPDatastoreSVM -volume DemoDS002 -aggregate aggr1 -size 1024GB -state online -tiering-policy snapshot-only -percent-snapshot-space 0 -autosize-mode grow -snapshot-policy none -junction-path /DemoDS002
+
*참고:* 셸을 통해 생성된 볼륨은 AWS 콘솔에 표시되기까지 몇 분 정도 걸립니다.

+
*기본적으로 설정되지 않은 볼륨 매개변수를 수정하는 명령:*

+
....
volume modify -vserver FSxONTAPDatastoreSVM -volume DemoDS002 -fractional-reserve 0
volume modify -vserver FSxONTAPDatastoreSVM -volume DemoDS002 -space-mgmt-try-first vol_grow
volume modify -vserver FSxONTAPDatastoreSVM -volume DemoDS002 -autosize-mode grow
....
+
image:fsx-nfs-008.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+
image:fsx-nfs-009.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 초기 마이그레이션 시나리오에서 기본 스냅샷 정책으로 인해 데이터 저장소 용량이 가득 차는 문제가 발생할 수 있습니다.  이를 극복하려면 필요에 맞게 스냅샷 정책을 수정하세요.

. *파일 시스템 만들기* 페이지에 표시된 파일 시스템 구성을 검토하세요.
. *파일 시스템 만들기*를 클릭합니다.
+
image:fsx-nfs-010.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+
image:fsx-nfs-011.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 이전 단계를 반복하여 용량 및 성능 요구 사항에 따라 더 많은 스토리지 가상 머신이나 파일 시스템과 데이터 저장소 볼륨을 만듭니다.



Amazon FSx ONTAP 성능에 대해 알아보려면 다음을 참조하세요. https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["Amazon FSx ONTAP 성능"^] .

====
.2단계: SDDC 그룹 만들기
[%collapsible%open]
====
파일 시스템과 SVM을 만든 후 VMware Console을 사용하여 SDDC 그룹을 만들고 VMware Transit Connect를 구성합니다.  그렇게 하려면 다음 단계를 완료하고 VMware Cloud Console과 AWS Console 간을 이동해야 한다는 점을 기억하세요.

. VMC 콘솔에 로그인하세요 `https://vmc.vmware.com` .
. *인벤토리* 페이지에서 *SDDC 그룹*을 클릭합니다.
. *SDDC 그룹* 탭에서 *작업*을 클릭하고 *SDDC 그룹 만들기*를 선택합니다.  데모 목적으로 SDDC 그룹을 호출합니다. `FSxONTAPDatastoreGrp` .
. 멤버십 그리드에서 그룹 멤버로 포함할 SDDC를 선택합니다.
+
image:fsx-nfs-012.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. "그룹에 VMware Transit Connect를 구성하면 첨부 파일 및 데이터 전송당 요금이 부과됩니다"가 선택되어 있는지 확인한 다음, *그룹 만들기*를 선택합니다.  이 과정을 완료하는 데 몇 분이 걸릴 수 있습니다.
+
image:fsx-nfs-013.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]



====
.3단계: VMware Transit Connect 구성
[%collapsible%open]
====
. 새로 생성된 지정된 VPC를 SDDC 그룹에 연결합니다.  *외부 VPC* 탭을 선택하고 다음을 따르세요. https://docs.vmware.com/en/VMware-Cloud-on-AWS/services/com.vmware.vmc-aws-networking-security/GUID-A3D03968-350E-4A34-A53E-C0097F5F26A9.html["그룹에 외부 VPC를 연결하기 위한 지침"^] .  이 과정을 완료하는 데 10~15분이 걸릴 수 있습니다.
+
image:fsx-nfs-014.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *계정 추가*를 클릭하세요.
+
.. FSx ONTAP 파일 시스템을 프로비저닝하는 데 사용된 AWS 계정을 제공합니다.
.. *추가*를 클릭하세요.


. AWS 콘솔로 돌아와서 동일한 AWS 계정에 로그인하고 *Resource Access Manager* 서비스 페이지로 이동합니다.  리소스 공유를 수락할 수 있는 버튼이 있습니다.
+
image:fsx-nfs-015.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 외부 VPC 프로세스의 일부로 AWS 콘솔을 통해 Resource Access Manager를 통해 새로운 공유 리소스에 대한 메시지가 표시됩니다.  공유 리소스는 VMware Transit Connect가 관리하는 AWS Transit Gateway입니다.

. *리소스 공유 수락*을 클릭합니다.
+
image:fsx-nfs-016.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. VMC 콘솔로 돌아가면 이제 외부 VPC가 연결된 상태임을 확인할 수 있습니다.  나타나기까지 몇 분 정도 걸릴 수 있습니다.


====
.4단계: 트랜짓 게이트웨이 첨부 파일 만들기
[%collapsible%open]
====
. AWS 콘솔에서 VPC 서비스 페이지로 이동하여 FSx 파일 시스템 프로비저닝에 사용된 VPC로 이동합니다.  오른쪽 탐색 창에서 *전송 게이트웨이 첨부*를 클릭하여 전송 게이트웨이 첨부를 만듭니다.
. *VPC 연결*에서 DNS 지원이 선택되어 있는지 확인하고 FSx ONTAP 배포된 VPC를 선택합니다.
+
image:fsx-nfs-017.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *트랜짓 게이트웨이 첨부 파일 만들기*를 클릭합니다.
+
image:fsx-nfs-018.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. VMware Cloud Console로 돌아와 SDDC 그룹 > 외부 VPC 탭으로 돌아갑니다.  FSx에 사용된 AWS 계정 ID를 선택하고 VPC를 클릭한 후 *수락*을 클릭합니다.
+
image:fsx-nfs-019.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+
image:fsx-nfs-020.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 이 옵션이 나타나기까지 몇 분 정도 걸릴 수 있습니다.

. 그런 다음 *경로* 열의 *외부 VPC* 탭에서 *경로 추가* 옵션을 클릭하고 필요한 경로를 추가합니다.
+
** Amazon FSx ONTAP 플로팅 IP에 대한 플로팅 IP 범위에 대한 경로입니다.
** 새로 생성된 외부 VPC 주소 공간에 대한 경로입니다.
+
image:fsx-nfs-021.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+
image:fsx-nfs-022.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]





====
.5단계: 라우팅(AWS VPC 및 SDDC) 및 보안 그룹 구성
[%collapsible%open]
====
. AWS 콘솔에서 VPC 서비스 페이지에서 VPC를 찾아 SDDC로 돌아가는 경로를 만들고 VPC에 대한 *기본* 경로 테이블을 선택합니다.
. 하단 패널에서 경로 테이블을 찾아 *경로 편집*을 클릭합니다.
+
image:fsx-nfs-023.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *경로 편집* 패널에서 *경로 추가*를 클릭하고 *전송 게이트웨이*를 선택하여 SDDC 인프라의 CIDR과 관련 TGW ID를 입력합니다.  *변경 사항 저장*을 클릭합니다.
+
image:fsx-nfs-024.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 다음 단계는 연관된 VPC의 보안 그룹이 SDDC 그룹 CIDR에 대한 올바른 인바운드 규칙으로 업데이트되었는지 확인하는 것입니다.
. SDDC 인프라의 CIDR 블록으로 인바운드 규칙을 업데이트합니다.
+
image:fsx-nfs-025.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

+

NOTE: 연결 문제를 방지하기 위해 VPC(FSx ONTAP 있는 곳) 경로 테이블이 업데이트되었는지 확인하세요.

+

NOTE: NFS 트래픽을 허용하도록 보안 그룹을 업데이트합니다.



이는 적절한 SDDC에 대한 연결을 준비하는 마지막 단계입니다.  파일 시스템을 구성하고, 경로를 추가하고, 보안 그룹을 업데이트했으므로 이제 데이터 저장소를 마운트할 차례입니다.

====
.6단계: NFS 볼륨을 SDDC 클러스터에 데이터 저장소로 연결
[%collapsible%open]
====
파일 시스템이 프로비저닝되고 연결이 설정되면 VMware Cloud Console에 액세스하여 NFS 데이터 저장소를 마운트합니다.

. VMC 콘솔에서 SDDC의 *저장소* 탭을 엽니다.
+
image:fsx-nfs-027.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *데이터스토어 연결*을 클릭하고 필요한 값을 입력하세요.
+

NOTE: NFS 서버 주소는 AWS 콘솔의 FSx > 스토리지 가상 머신 탭 > 엔드포인트에서 찾을 수 있는 NFS IP 주소입니다.

+
image:fsx-nfs-028.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *데이터 저장소 연결*을 클릭하여 클러스터에 데이터 저장소를 연결합니다.
+
image:fsx-nfs-029.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 아래와 같이 vCenter에 액세스하여 NFS 데이터 저장소를 검증합니다.
+
image:fsx-nfs-030.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]



====