---
sidebar: sidebar 
permalink: vmware/vmw-aws-fsxn-vmc-ds-dr-veeam.html 
keywords: disaster recovery, vmc, vmware cloud, aws, amazon web services, fsxn, FSx ONTAP, FSx ONTAP, disaster recovery, dr, veeam, replication 
summary:  
---
= AWS에서 VMware Cloud로의 재해 복구를 위해 Veeam Replication 및 FSx ONTAP 사용
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
AWS의 VMware Cloud와 통합된 Amazon FSx ONTAP SDDC의 클러스터에 연결할 수 있는 NetApp의 ONTAP 파일 시스템을 기반으로 구축된 AWS 관리형 외부 NFS 데이터 저장소입니다.  고객에게 컴퓨팅 리소스에 관계없이 확장 가능한 유연하고 고성능의 가상화된 스토리지 인프라를 제공합니다.



== 개요

재해 복구 대상으로 VMware Cloud on AWS SDDC를 사용하려는 고객의 경우, FSx ONTAP 데이터 저장소를 사용하면 VM 복제 기능을 제공하는 검증된 타사 솔루션을 사용하여 온프레미스에서 데이터를 복제할 수 있습니다.  FSx ONTAP 데이터스토어를 추가하면 스토리지를 수용하기 위해 엄청난 양의 ESXi 호스트를 사용하여 AWS SDDC에 VMware 클라우드를 구축하는 것보다 비용 최적화된 배포가 가능해집니다.

이 접근 방식은 고객이 FSx ONTAP 데이터 저장소와 함께 VMC의 파일럿 라이트 클러스터를 사용하여 VM 복제본을 호스팅하는 데에도 도움이 됩니다.  동일한 프로세스를 VMware Cloud on AWS로 마이그레이션 옵션으로 확장하여 복제 계획을 정상적으로 장애 조치할 수도 있습니다.



== 문제 진술

이 문서에서는 FSx ONTAP 데이터 저장소와 Veeam 백업 및 복제를 사용하여 VM 복제 기능을 사용하여 온프레미스 VMware VM을 VMware Cloud on AWS로 재해 복구를 설정하는 방법을 설명합니다.

Veeam Backup & Replication을 사용하면 재해 복구(DR)를 위한 온사이트 및 원격 복제가 가능합니다.  가상 머신이 복제되면 Veeam Backup & Replication은 대상 VMware Cloud on AWS SDDC 클러스터에 기본 VMware vSphere 형식으로 VM의 정확한 복사본을 만들고 복사본을 원본 VM과 동기화된 상태로 유지합니다.

복제는 VM의 복사본이 시작 준비 상태에 있으므로 최상의 복구 시간 목표(RTO) 값을 제공합니다.  이 복제 메커니즘은 재해 발생 시 VMware Cloud on AWS SDDC에서 워크로드를 신속하게 시작할 수 있도록 보장합니다.  Veeam Backup & Replication 소프트웨어는 WAN 및 느린 연결을 통한 복제를 위한 트래픽 전송도 최적화합니다.  또한 중복 데이터 블록, 제로 데이터 블록, 스왑 파일 및 제외된 VM 게스트 OS 파일을 필터링하고 복제 트래픽을 압축합니다.

복제 작업이 전체 네트워크 대역폭을 소모하는 것을 방지하려면 WAN 가속기와 네트워크 제한 규칙을 적용할 수 있습니다.  Veeam Backup & Replication의 복제 프로세스는 작업 중심입니다. 즉, 복제는 복제 작업을 구성하여 수행됩니다.  재해가 발생하는 경우 복제본으로 장애 조치를 취하여 VM을 복구할 수 있습니다.

장애 조치가 수행되면 복제된 VM이 원래 VM의 역할을 대신하게 됩니다.  장애 조치는 복제본의 최신 상태나 잘 알려진 복원 지점으로 수행할 수 있습니다.  이를 통해 필요에 따라 랜섬웨어 복구나 분리된 테스트가 가능합니다.  Veeam Backup & Replication에서 장애 조치(failover)와 장애 복구(failback)는 추후에 마무리되어야 하는 임시적인 중간 단계입니다.  Veeam Backup & Replication은 다양한 재해 복구 시나리오를 처리하기 위한 여러 가지 옵션을 제공합니다.

image:dr-veeam-fsx-001.png["VMC용 Veeam Replication 및 FSx ONTAP 사용한 DR 시나리오 다이어그램"]



== 솔루션 배포



=== 높은 수준의 단계

. Veeam Backup and Replication 소프트웨어는 적절한 네트워크 연결을 갖춘 온프레미스 환경에서 실행됩니다.
. AWS에서 VMware Cloud 구성, VMware Cloud Tech Zone 문서 참조link:https://vmc.techzone.vmware.com/fsx-guide["Amazon FSx ONTAP 배포 가이드와 VMware Cloud on AWS 통합"] 배포하려면 VMware Cloud on AWS SDDC 및 FSx ONTAP NFS 데이터 저장소로 구성합니다.  (최소한의 구성으로 설정된 조종등 환경은 DR 목적으로 사용될 수 있습니다.  사고 발생 시 VM은 이 클러스터로 장애 조치되며, 추가 노드를 추가할 수 있습니다.
. Veeam Backup and Replication을 사용하여 VM 복제본을 생성하기 위한 복제 작업을 설정합니다.
. 장애 조치 계획을 수립하고 장애 조치를 수행합니다.
. 재해 이벤트가 완료되고 기본 사이트가 가동되면 프로덕션 VM으로 다시 전환합니다.




=== VMC 및 FSx ONTAP 데이터 저장소에 대한 Veeam VM 복제를 위한 필수 구성 요소

. Veeam Backup & Replication 백업 VM이 AWS SDDC 클러스터의 소스 vCenter와 대상 VMware 클라우드에 연결되어 있는지 확인하세요.
. 백업 서버는 짧은 이름을 확인하고 소스 및 대상 vCenter에 연결할 수 있어야 합니다.
. 대상 FSx ONTAP 데이터 저장소에는 복제된 VM의 VMDK를 저장할 수 있는 충분한 여유 공간이 있어야 합니다.


추가 정보는 "고려사항 및 제한사항"을 참조하세요.link:https://helpcenter.veeam.com/docs/backup/vsphere/replica_limitations.html?ver=120["여기"] .



=== 배포 세부 정보

.1단계: VM 복제
[%collapsible%open]
====
Veeam Backup & Replication은 VMware vSphere 스냅샷 기능을 활용하며 복제 중에 Veeam Backup & Replication은 VMware vSphere에 VM 스냅샷을 생성하도록 요청합니다.  VM 스냅샷은 가상 디스크, 시스템 상태, 구성 등을 포함하는 VM의 특정 시점 복사본입니다.  Veeam Backup & Replication은 복제를 위한 데이터 소스로 스냅샷을 사용합니다.

VM을 복제하려면 다음 단계를 따르세요.

. Veeam 백업 및 복제 콘솔을 엽니다.
. 홈 보기에서 복제 작업 > 가상 머신 > VMware vSphere를 선택합니다.
. 작업 이름을 지정하고 적절한 고급 제어 확인란을 선택합니다. 다음을 클릭하세요.
+
** 온프레미스와 AWS 간 연결의 대역폭이 제한된 경우 복제본 시딩 확인란을 선택합니다.
** VMware Cloud on AWS SDDC의 세그먼트가 온프레미스 사이트 네트워크의 세그먼트와 일치하지 않는 경우 네트워크 재매핑(다른 네트워크를 사용하는 AWS VMC 사이트용) 확인란을 선택합니다.
** 온프레미스 프로덕션 사이트의 IP 주소 지정 체계가 AWS VMC 사이트의 체계와 다른 경우, 복제본 재IP(IP 주소 지정 체계가 다른 DR 사이트용) 확인란을 선택합니다.
+
image:dr-veeam-fsx-002.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]



. *가상 머신* 단계에서 VMware Cloud on AWS SDDC에 연결된 FSx ONTAP 데이터 저장소에 복제해야 하는 VM을 선택합니다.  가상 머신을 vSAN에 배치하여 사용 가능한 vSAN 데이터 저장소 용량을 채울 수 있습니다.  파일럿 라이트 클러스터에서는 3노드 클러스터의 사용 가능한 용량이 제한됩니다.  나머지 데이터는 FSx ONTAP 데이터 저장소에 복제될 수 있습니다.  *추가*를 클릭한 다음, *개체 추가* 창에서 필요한 VM이나 VM 컨테이너를 선택하고 *추가*를 클릭합니다. *다음*을 클릭하세요.
+
image:dr-veeam-fsx-003.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 그런 다음 대상을 VMware Cloud on AWS SDDC 클러스터/호스트로 선택하고, VM 복제본에 대한 적절한 리소스 풀, VM 폴더 및 FSx ONTAP 데이터 저장소를 선택합니다.  그런 다음 *다음*을 클릭하세요.
+
image:dr-veeam-fsx-004.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 다음 단계에서는 필요에 따라 소스 및 대상 가상 네트워크 간의 매핑을 만듭니다.
+
image:dr-veeam-fsx-005.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. *작업 설정* 단계에서 VM 복제본, 보존 정책 등의 메타데이터를 저장할 백업 저장소를 지정합니다.
. *데이터 전송* 단계에서 *소스* 및 *대상* 프록시 서버를 업데이트하고 *자동* 선택(기본값)을 그대로 두고 *직접* 옵션을 선택된 상태로 두고 *다음*을 클릭합니다.
. *게스트 처리* 단계에서 필요에 따라 *애플리케이션 인식 처리 사용* 옵션을 선택합니다. *다음*을 클릭하세요.
+
image:dr-veeam-fsx-006.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 정기적으로 복제 작업을 실행하려면 복제 일정을 선택하세요.
. 마법사의 *요약* 단계에서 복제 작업의 세부 정보를 검토합니다.  마법사를 닫은 직후 작업을 시작하려면 *마침을 클릭하면 작업 실행* 확인란을 선택하고, 그렇지 않으면 확인란을 선택하지 않습니다.  그런 다음 *마침*을 클릭하여 마법사를 닫습니다.
+
image:dr-veeam-fsx-007.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]



복제 작업이 시작되면 지정된 접미사가 있는 VM이 대상 VMC SDDC 클러스터/호스트에 채워집니다.

image:dr-veeam-fsx-008.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

Veeam 복제에 대한 추가 정보는 다음을 참조하세요.link:https://helpcenter.veeam.com/docs/backup/vsphere/replication_process.html?ver=120["복제 작동 방식"] .

====
.2단계: 장애 조치 계획 만들기
[%collapsible%open]
====
초기 복제 또는 시딩이 완료되면 장애 조치 계획을 만듭니다.  장애 조치 계획은 종속된 VM에 대해 하나씩 또는 그룹별로 자동으로 장애 조치를 수행하는 데 도움이 됩니다.  장애 조치 계획은 부팅 지연을 포함하여 VM이 처리되는 순서에 대한 청사진입니다.  장애 조치 계획은 또한 중요한 종속 VM이 이미 실행 중인지 확인하는 데 도움이 됩니다.

계획을 생성하려면 복제본이라는 새 하위 섹션으로 이동하여 장애 조치 계획을 선택합니다.  적절한 VM을 선택하세요.  Veeam Backup & Replication은 이 시점에 가장 가까운 복원 지점을 찾아 이를 사용하여 VM 복제본을 시작합니다.


NOTE: 장애 조치 계획은 초기 복제가 완료되고 VM 복제본이 준비 상태가 된 후에만 추가할 수 있습니다.


NOTE: 장애 조치 계획을 실행할 때 동시에 시작할 수 있는 VM의 최대 수는 10개입니다.


NOTE: 장애 조치 프로세스 동안 소스 VM의 전원은 꺼지지 않습니다.

*장애 조치 계획*을 생성하려면 다음을 수행하세요.

. 홈 보기에서 *장애 조치 계획 > VMware vSphere*를 선택합니다.
. 다음으로, 계획의 이름과 설명을 입력하세요.  필요에 따라 사전 및 사후 장애 조치 스크립트를 추가할 수 있습니다.  예를 들어, 복제된 VM을 시작하기 전에 VM을 종료하는 스크립트를 실행합니다.
+
image:dr-veeam-fsx-009.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

. 계획에 VM을 추가하고 애플리케이션 종속성을 충족하도록 VM 부팅 순서와 부팅 지연을 수정합니다.
+
image:dr-veeam-fsx-010.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]



복제 작업 생성에 대한 추가 정보는 다음을 참조하세요.link:https://helpcenter.veeam.com/docs/backup/vsphere/replica_job.html?ver=120["복제 작업 생성"] .

====
.3단계: 장애 조치 계획 실행
[%collapsible%open]
====
장애 조치(failover) 중에 프로덕션 사이트의 소스 VM은 재해 복구 사이트의 복제본으로 전환됩니다.  장애 조치 프로세스의 일부로 Veeam Backup & Replication은 VM 복제본을 필요한 복구 지점으로 복원하고 모든 I/O 활동을 소스 VM에서 복제본으로 이동합니다.  복제본은 재난 발생 시뿐만 아니라 DR 훈련을 시뮬레이션하는 데에도 사용할 수 있습니다.  장애 조치 시뮬레이션 중에 소스 VM은 계속 실행됩니다.  필요한 모든 테스트가 수행되면 장애 조치를 취소하고 정상적인 작업으로 돌아갈 수 있습니다.


NOTE: DR 훈련 중 IP 충돌을 피하기 위해 네트워크 분할이 제대로 되어 있는지 확인하세요.

장애 조치 계획을 시작하려면 *장애 조치 계획* 탭을 클릭하고 장애 조치 계획을 마우스 오른쪽 버튼으로 클릭합니다.  *시작*을 선택하세요.  이렇게 하면 VM 복제본의 최신 복원 지점을 사용하여 장애 조치가 수행됩니다.  VM 복제본의 특정 복원 지점으로 장애 조치를 수행하려면 *시작*을 선택합니다.

image:dr-veeam-fsx-011.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

image:dr-veeam-fsx-012.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

VM 복제본 상태가 준비에서 장애 조치로 변경되고 VM이 대상 VMware Cloud on AWS SDDC 클러스터/호스트에서 시작됩니다.

image:dr-veeam-fsx-013.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

장애 조치가 완료되면 VM 상태가 "장애 조치"로 변경됩니다.

image:dr-veeam-fsx-014.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]


NOTE: Veeam Backup & Replication은 복제본이 준비 상태로 돌아올 때까지 소스 VM에 대한 모든 복제 활동을 중지합니다.

장애 조치 계획에 대한 자세한 내용은 다음을 참조하세요.link:https://helpcenter.veeam.com/docs/backup/vsphere/failover_plan.html?ver=120["장애 조치 계획"] .

====
.4단계: 프로덕션 사이트로 장애 복구
[%collapsible%open]
====
장애 조치 계획이 실행 중일 때는 중간 단계로 간주되며 요구 사항에 따라 마무리되어야 합니다.  옵션은 다음과 같습니다.

* *운영 환경으로의 장애 복구* - 원래 VM으로 다시 전환하고 VM 복제본이 실행되는 동안 발생한 모든 변경 사항을 원래 VM으로 전송합니다.



NOTE: 장애 복구를 수행하면 변경 사항은 전송만 되고 게시되지는 않습니다.  원래 VM이 예상대로 작동하는 것이 확인되면 *장애 복구 커밋*을 선택하고, 원래 VM이 예상대로 작동하지 않으면 *장애 복구 실행 취소*를 선택하여 VM 복제본으로 돌아갑니다.

* *장애 조치 취소* - 원래 VM으로 다시 전환하고 실행 중이던 VM 복제본에 적용된 모든 변경 사항을 취소합니다.
* *영구적 장애 조치* - 원본 VM에서 VM 복제본으로 영구적으로 전환하고 이 복제본을 원본 VM으로 사용합니다.


이 데모에서는 프로덕션으로의 장애 복구가 선택되었습니다.  마법사의 대상 단계에서 원래 VM으로의 장애 복구가 선택되었고 "복원 후 VM 전원 켜기" 확인란이 활성화되었습니다.

image:dr-veeam-fsx-015.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

image:dr-veeam-fsx-016.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

장애 복구 커밋은 장애 복구 작업을 마무리하는 방법 중 하나입니다.  장애 복구가 커밋되면 장애 복구된 VM(프로덕션 VM)에 전송된 변경 사항이 예상대로 작동하는지 확인됩니다.  커밋 작업 후 Veeam Backup & Replication은 프로덕션 VM에 대한 복제 활동을 재개합니다.

장애 복구 프로세스에 대한 자세한 내용은 Veeam 설명서를 참조하세요.link:https://helpcenter.veeam.com/docs/backup/vsphere/failover_failback.html?ver=120["복제를 위한 장애 조치 및 장애 복구"] .

image:dr-veeam-fsx-017.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

image:dr-veeam-fsx-018.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

운영 환경으로의 장애 복구가 성공적으로 완료되면 모든 VM이 원래 운영 사이트로 복원됩니다.

image:dr-veeam-fsx-019.png["입력/출력 대화 상자 또는 서면 내용을 나타내는 그림"]

====


== 결론

FSx ONTAP 데이터 저장소 기능을 사용하면 Veeam이나 검증된 타사 도구가 파일럿 라이트 클러스터를 사용하여 저비용 DR 솔루션을 제공할 수 있으며, VM 복제본 사본을 수용하기 위해 클러스터에 많은 수의 호스트를 구축하지 않아도 됩니다.  이를 통해 맞춤형 재해 복구 계획을 처리할 수 있는 강력한 솔루션을 제공하고, 재해 복구 요구 사항을 충족하기 위해 사내 기존 백업 제품을 재사용할 수 있으므로 사내 재해 복구 데이터센터를 종료하고 클라우드 기반 재해 복구가 가능해집니다.  장애 조치는 계획된 장애 조치로 수행할 수도 있고, 재해가 발생하고 DR 사이트를 활성화하기로 결정한 경우 버튼을 클릭하여 장애 조치를 수행할 수도 있습니다.

이 과정에 대해 자세히 알아보려면 자세한 안내 영상을 시청하세요.

video::15fed205-8614-4ef7-b2d0-b061015e925a[panopto,width=Video walkthrough of the solution]