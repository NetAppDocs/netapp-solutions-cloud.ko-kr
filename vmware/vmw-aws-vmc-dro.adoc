---
sidebar: sidebar 
permalink: vmware/vmw-aws-vmc-dro.html 
keywords: NetApp Solutions, hybrid, multicloud, multi cloud, hyperscalers, vmware, disaster recovery orchestrator, DRO 
summary:  
---
= TR-4955: FSx ONTAP 및 VMC(AWS VMware Cloud)를 사용한 재해 복구
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
DRO(재해 복구 오케스트레이터, UI가 있는 스크립트 솔루션)를 사용하면 온프레미스에서 FSx ONTAP 으로 복제된 워크로드를 원활하게 복구할 수 있습니다.  DRO는 SnapMirror 수준에서 VM 등록을 거쳐 VMC로, 그리고 NSX-T에서 직접 네트워크 매핑까지 복구를 자동화합니다. 이 기능은 모든 VMC 환경에 포함되어 있습니다.

니야즈 모하메드, NetApp



== 개요

클라우드로 재해 복구를 수행하는 것은 사이트 중단 및 데이터 손상 사고(예: 랜섬웨어)로부터 작업 부하를 보호하는 탄력적이고 비용 효율적인 방법입니다.  NetApp SnapMirror 기술을 사용하면 온프레미스 VMware 워크로드를 AWS에서 실행되는 FSx ONTAP 으로 복제할 수 있습니다.

DRO(재해 복구 오케스트레이터, UI가 있는 스크립트 솔루션)를 사용하면 온프레미스에서 FSx ONTAP 으로 복제된 워크로드를 원활하게 복구할 수 있습니다.  DRO는 SnapMirror 수준에서 VM 등록을 거쳐 VMC로, 그리고 NSX-T에서 직접 네트워크 매핑까지 복구를 자동화합니다. 이 기능은 모든 VMC 환경에 포함되어 있습니다.

image:dro-vmc-001.png["이 그래픽은 온프레미스 데이터 센터, VMware Cloud on AWS SDDC 인스턴스, Amazon FSx ONTAP 간의 구조와 상호 연결을 보여줍니다.  여기에는 SnapMirror 복제, DRaaS Ops 트래픽, 인터넷 또는 직접 연결, VMware Transit Connect가 포함됩니다."]



== 시작하기



=== AWS에서 VMware Cloud 배포 및 구성

link:https://www.vmware.com/products/vmc-on-aws.html["AWS의 VMware 클라우드"^]AWS 생태계에서 VMware 기반 워크로드에 대한 클라우드 네이티브 환경을 제공합니다.  각 VMware 소프트웨어 정의 데이터 센터(SDDC)는 Amazon Virtual Private Cloud(VPC)에서 실행되며 전체 VMware 스택(vCenter Server 포함), NSX-T 소프트웨어 정의 네트워킹, vSAN 소프트웨어 정의 스토리지, 워크로드에 컴퓨팅 및 스토리지 리소스를 제공하는 하나 이상의 ESXi 호스트를 제공합니다.  AWS에서 VMC 환경을 구성하려면 다음 단계를 따르세요.link:vmw-aws-vmc-setup.html["링크"^] .  조종등 클러스터도 DR 목적으로 사용될 수 있습니다.


NOTE: 초기 릴리스에서는 DRO가 기존 조종등 클러스터를 지원합니다.  온디맨드 SDDC 생성은 향후 릴리스에서 제공될 예정입니다.



=== FSx ONTAP 프로비저닝 및 구성

Amazon FSx ONTAP 인기 있는 NetApp ONTAP 파일 시스템을 기반으로 높은 안정성, 확장성, 고성능, 다양한 기능을 갖춘 파일 스토리지를 제공하는 완전 관리형 서비스입니다.  이 단계를 따르세요link:vmw-aws-vmc-nfs-ds-overview.html["링크"^] FSx ONTAP 프로비저닝하고 구성합니다.



=== FSx ONTAP 에 SnapMirror 배포 및 구성

다음 단계는 NetApp BlueXP 사용하여 AWS 인스턴스에서 프로비저닝된 FSx ONTAP 검색하고 적절한 빈도와 NetApp 스냅샷 복사본 보존을 사용하여 온프레미스 환경에서 FSx ONTAP 으로 원하는 데이터 저장소 볼륨을 복제하는 것입니다.

image:dro-vmc-002.png["이 그래픽은 활성화된 서비스 간의 다양한 상호작용을 보여주는 BlueXP Canvas 관계 맵을 나타냅니다."]

이 링크의 단계에 따라 BlueXP 구성하세요.  이 링크를 따라 NetApp ONTAP CLI를 사용하여 복제를 예약할 수도 있습니다.


NOTE: SnapMirror 관계는 필수 조건이므로 미리 만들어야 합니다.



== DRO 설치

DRO를 시작하려면 지정된 EC2 인스턴스나 가상 머신에서 Ubuntu 운영 체제를 사용하여 필수 구성 요소를 충족하는지 확인하세요.  그런 다음 패키지를 설치하세요.



=== 필수 조건

* 소스 및 대상 vCenter와 스토리지 시스템에 대한 연결이 있는지 확인하세요.
* DNS 이름을 사용하는 경우 DNS 확인이 이루어져야 합니다.  그렇지 않은 경우 vCenter 및 스토리지 시스템에 IP 주소를 사용해야 합니다.
* 루트 권한이 있는 사용자를 만듭니다.  EC2 인스턴스에서도 sudo를 사용할 수 있습니다.




=== OS 요구 사항

* 최소 2GB 및 4개의 vCPU를 갖춘 Ubuntu 20.04(LTS)
* 지정된 에이전트 VM에 다음 패키지를 설치해야 합니다.
+
** 도커
** Docker-compose
** 제이큐




권한 변경 `docker.sock` : `sudo chmod 666 /var/run/docker.sock` .


NOTE: 그만큼 `deploy.sh` 스크립트는 모든 필수 전제 조건을 실행합니다.



=== 패키지를 설치하세요

. 지정된 가상 머신에 설치 패키지를 다운로드하세요.
+
[listing]
----
git clone https://github.com/NetApp/DRO-AWS.git
----
+

NOTE: 에이전트는 온프레미스 또는 AWS VPC 내에 설치할 수 있습니다.

. 패키지의 압축을 풀고 배포 스크립트를 실행한 다음 호스트 IP(예: 10.10.10.10)를 입력합니다.
+
[listing]
----
tar xvf DRO-prereq.tar
----
. 디렉토리로 이동하여 다음과 같이 배포 스크립트를 실행합니다.
+
[listing]
----
sudo sh deploy.sh
----
. UI에 액세스하려면 다음을 사용하세요.
+
[listing]
----
https://<host-ip-address>
----
+
다음 기본 자격 증명을 사용합니다.

+
[listing]
----
Username: admin
Password: admin
----



NOTE: 비밀번호는 "비밀번호 변경" 옵션을 사용하여 변경할 수 있습니다.

image:dro-vmc-003.png["재해 복구 오케스트레이터 로그인 화면입니다."]



== DRO 구성

FSx ONTAP 과 VMC가 올바르게 구성된 후 FSx ONTAP 의 읽기 전용 SnapMirror 복사본을 사용하여 온프레미스 워크로드를 VMC로 복구하는 작업을 자동화하도록 DRO를 구성할 수 있습니다.

NetApp DRO 에이전트를 AWS에 배포하고 FSx ONTAP 배포된 동일한 VPC에 배포하는 것을 권장합니다(피어 연결도 가능). 이렇게 하면 DRO 에이전트가 네트워크를 통해 온프레미스 구성 요소뿐 아니라 FSx ONTAP 및 VMC 리소스와도 통신할 수 있습니다.

첫 번째 단계는 온프레미스 및 클라우드 리소스(vCenter와 스토리지 모두)를 검색하여 DRO에 추가하는 것입니다.  지원되는 브라우저에서 DRO를 열고 기본 사용자 이름과 비밀번호(admin/admin)를 사용하고 사이트를 추가합니다.  Discover 옵션을 사용하여 사이트를 추가할 수도 있습니다.  다음 플랫폼을 추가하세요:

* 온프레미스
+
** 온프레미스 vCenter
** ONTAP 스토리지 시스템


* 클라우드
+
** VMC vCenter
** FSx ONTAP




image:dro-vmc-004.png["임시 플레이스홀더 이미지 설명입니다."]

image:dro-vmc-005.png["소스 및 대상 사이트를 포함하는 DRO 사이트 개요 페이지입니다."]

DRO가 추가되면 자동 검색을 수행하고 소스 스토리지에서 FSx ONTAP 으로의 해당 SnapMirror 복제본이 있는 VM을 표시합니다.  DRO는 VM에서 사용하는 네트워크와 포트 그룹을 자동으로 감지하고 이를 채웁니다.

image:dro-vmc-006.png["219개의 VM과 10개의 데이터 저장소를 포함하는 자동 검색 화면입니다."]

다음 단계는 필요한 VM을 기능 그룹으로 그룹화하여 리소스 그룹으로 사용하는 것입니다.



=== 리소스 그룹화

플랫폼을 추가한 후에는 복구하려는 VM을 리소스 그룹으로 그룹화할 수 있습니다.  DRO 리소스 그룹을 사용하면 종속된 VM 세트를 부팅 순서, 부팅 지연, 복구 시 실행할 수 있는 선택적 애플리케이션 유효성 검사가 포함된 논리적 그룹으로 그룹화할 수 있습니다.

리소스 그룹을 만들려면 다음 단계를 완료하세요.

. *리소스 그룹*에 액세스하고 *새 리소스 그룹 만들기*를 클릭합니다.
. *새 리소스 그룹*에서 드롭다운에서 소스 사이트를 선택하고 *만들기*를 클릭합니다.
. *리소스 그룹 세부 정보*를 제공하고 *계속*을 클릭합니다.
. 검색 옵션을 사용하여 적절한 VM을 선택하세요.
. 선택한 VM에 대한 부팅 순서와 부팅 지연(초)을 선택합니다.  각 VM을 선택하고 우선순위를 설정하여 전원 켜기 순서를 설정합니다.  모든 VM의 기본값은 3입니다.
+
옵션은 다음과 같습니다.

+
1 – 전원을 켜는 첫 번째 가상 머신 3 – 기본값 5 – 전원을 켜는 마지막 가상 머신

. *리소스 그룹 만들기*를 클릭합니다.


image:dro-vmc-007.png["두 개의 항목(테스트 및 DemoRG1)이 포함된 리소스 그룹 목록의 스크린샷입니다."]



=== 복제 계획

재해 발생 시 애플리케이션을 복구할 계획이 필요합니다.  드롭다운에서 소스 및 대상 vCenter 플랫폼을 선택하고 이 계획에 포함할 리소스 그룹을 선택하고, 애플리케이션을 복원하고 전원을 켜는 방법(예: 도메인 컨트롤러, 그 다음 1계층, 그 다음 2계층 등)을 그룹화합니다.  이러한 계획은 때때로 청사진이라고도 불립니다.  복구 계획을 정의하려면 *복제 계획* 탭으로 이동하여 *새 복제 계획*을 클릭합니다.

복제 계획을 만들려면 다음 단계를 완료하세요.

. *복제 계획*에 액세스하고 *새 복제 계획 만들기*를 클릭합니다.
+
image:dro-vmc-008.png["DemoRP라는 하나의 계획이 포함된 복제 계획 화면의 스크린샷입니다."]

. *새 복제 계획*에서 계획의 이름을 입력하고 소스 사이트, 관련 vCenter, 대상 사이트 및 관련 vCenter를 선택하여 복구 매핑을 추가합니다.
+
image:dro-vmc-009.png["복구 매핑을 포함한 복제 계획 세부정보의 스크린샷입니다."]

. 복구 매핑이 완료된 후 클러스터 매핑을 선택합니다.
+
image:dro-vmc-010.png["임시 플레이스홀더 이미지 설명입니다."]

. *리소스 그룹 세부 정보*를 선택하고 *계속*을 클릭합니다.
. 리소스 그룹에 대한 실행 순서를 설정합니다.  이 옵션을 사용하면 여러 리소스 그룹이 있는 경우 작업 순서를 선택할 수 있습니다.
. 작업이 끝나면 적절한 세그먼트에 대한 네트워크 매핑을 선택하세요.  세그먼트는 이미 VMC 내에 프로비저닝되어 있으므로 VM을 매핑할 적절한 세그먼트를 선택하세요.
. VM 선택에 따라 데이터 저장소 매핑이 자동으로 선택됩니다.
+

NOTE: SnapMirror 볼륨 레벨에 있습니다.  따라서 모든 VM은 복제 대상에 복제됩니다.  데이터 저장소에 속한 모든 VM을 선택해야 합니다.  선택하지 않으면 복제 계획에 포함된 VM만 처리됩니다.

+
image:dro-vmc-011.png["임시 플레이스홀더 이미지 설명입니다."]

. VM 세부 정보에서 선택적으로 VM의 CPU 및 RAM 매개변수 크기를 조정할 수 있습니다. 이 기능은 대규모 환경을 더 작은 대상 클러스터로 복구하거나 일대일 물리적 VMware 인프라를 프로비저닝하지 않고도 DR 테스트를 수행할 때 매우 유용합니다.  또한 리소스 그룹 전체에서 선택한 모든 VM의 부팅 순서와 부팅 지연(초)을 수정할 수 있습니다.  리소스 그룹 부팅 순서 선택 중에 선택한 내용에 변경 사항이 있는 경우 부팅 순서를 수정하는 추가 옵션이 있습니다.  기본적으로 리소스 그룹 선택 중에 선택된 부팅 순서가 사용됩니다. 그러나 이 단계에서 모든 수정 작업을 수행할 수 있습니다.
+
image:dro-vmc-012.png["임시 플레이스홀더 이미지 설명입니다."]

. *복제 계획 만들기*를 클릭합니다.
+
image:dro-vmc-013.png["임시 플레이스홀더 이미지 설명입니다."]



복제 계획이 생성된 후에는 요구 사항에 따라 장애 조치 옵션, 테스트 장애 조치 옵션 또는 마이그레이션 옵션을 실행할 수 있습니다.  장애 조치 및 테스트 장애 조치 옵션 동안 가장 최근의 SnapMirror 스냅샷 복사본이 사용되거나 특정 스냅샷 복사본을 특정 시점 스냅샷 복사본에서 선택할 수 있습니다( SnapMirror 의 보존 정책에 따라).  랜섬웨어와 같이 최신 복제본이 이미 손상되거나 암호화된 경우와 같이 손상 이벤트가 발생하는 경우 특정 시점 옵션이 매우 유용할 수 있습니다.  DRO는 이용 가능한 모든 시점을 보여줍니다.  복제 계획에 지정된 구성으로 장애 조치 또는 테스트 장애 조치를 트리거하려면 *장애 조치* 또는 *테스트 장애 조치*를 클릭하면 됩니다.

image:dro-vmc-014.png["임시 플레이스홀더 이미지 설명입니다."] image:dro-vmc-015.png["이 화면에서는 볼륨 스냅샷 세부 정보가 제공되며 최신 스냅샷을 사용할지 특정 스냅샷을 선택할 수 있습니다."]

복제 계획은 작업 메뉴에서 모니터링할 수 있습니다.

image:dro-vmc-016.png["작업 메뉴에는 복제 계획에 대한 모든 작업과 옵션이 표시되며 로그도 볼 수 있습니다."]

장애 조치가 트리거된 후 복구된 항목은 VMC vCenter(VM, 네트워크, 데이터 저장소)에서 볼 수 있습니다.  기본적으로 VM은 워크로드 폴더로 복구됩니다.

image:dro-vmc-017.png["임시 플레이스홀더 이미지 설명입니다."]

장애 복구는 복제 계획 수준에서 트리거될 수 있습니다.  테스트 장애 조치의 경우, 해체 옵션을 사용하여 변경 사항을 롤백하고 FlexClone 관계를 제거할 수 있습니다.  장애 조치와 관련된 장애 복구는 2단계 프로세스입니다.  복제 계획을 선택하고 *역방향 데이터 동기화*를 선택합니다.

image:dro-vmc-018.png["역방향 데이터 동기화 옵션이 포함된 드롭다운이 있는 복제 계획 개요의 스크린샷입니다."] image:dro-vmc-019.png["임시 플레이스홀더 이미지 설명입니다."]

완료되면 장애 복구를 트리거하여 원래 프로덕션 사이트로 돌아갈 수 있습니다.

image:dro-vmc-020.png["장애 복구 옵션이 포함된 드롭다운이 있는 복제 계획 개요의 스크린샷입니다."] image:dro-vmc-021.png["원래 생산 현장이 가동 중인 모습을 담은 DRO 요약 페이지의 스크린샷입니다."]

NetApp BlueXP 에서 해당 볼륨(VMC에 읽기-쓰기 볼륨으로 매핑된 볼륨)에 대한 복제 상태가 중단된 것을 확인할 수 있습니다.  테스트 장애 조치 중에 DRO는 대상 또는 복제 볼륨을 매핑하지 않습니다.  대신, 필요한 SnapMirror (또는 Snapshot) 인스턴스의 FlexClone 복사본을 만들고 FlexClone 인스턴스를 노출합니다. 이는 FSx ONTAP 에 대한 추가적인 물리적 용량을 소모하지 않습니다.  이 프로세스를 통해 볼륨이 수정되지 않고 DR 테스트나 분류 워크플로 중에도 복제 작업이 계속 진행될 수 있습니다.  또한, 이 프로세스를 통해 오류가 발생하거나 손상된 데이터가 복구된 경우 복제본이 파괴될 위험 없이 복구를 정리할 수 있습니다.

image:dro-vmc-022.png["임시 플레이스홀더 이미지 설명입니다."]



=== 랜섬웨어 복구

랜섬웨어로부터 복구하는 것은 힘든 일일 수 있습니다.  특히, IT 조직에서는 안전한 복귀 지점이 어디인지 정확히 파악하기 어려울 수 있으며, 이를 파악한 후에도 잠복해 있는 맬웨어나 취약한 애플리케이션 등의 재발 공격으로부터 복구된 워크로드를 보호하기가 어려울 수 있습니다.

DRO를 사용하면 언제든지 시스템을 복구할 수 있어 이러한 문제를 해결할 수 있습니다.  또한, 남북 트래픽에 노출되지 않은 위치에서 애플리케이션이 작동하고 서로 통신할 수 있도록 작업 부하를 기능적이면서도 격리된 네트워크로 복구할 수도 있습니다.  이를 통해 보안 팀은 법의학 조사를 수행하고 숨겨진 맬웨어나 잠복하고 있는 맬웨어가 없는지 확인할 수 있는 안전한 장소를 확보할 수 있습니다.



== 이익

* 효율적이고 탄력적인 SnapMirror 복제를 사용합니다.
* 스냅샷 사본 보존을 통해 사용 가능한 어느 시점으로든 복구합니다.
* 저장소, 컴퓨팅, 네트워크 및 애플리케이션 검증 단계에서 수백 개에서 수천 개의 VM을 복구하는 데 필요한 모든 단계를 완전히 자동화합니다.
* 복제된 볼륨을 변경하지 않는 방법을 사용하는 ONTAP FlexClone 기술을 사용하여 워크로드를 복구합니다.
+
** 볼륨이나 스냅샷 복사본의 데이터 손상 위험을 방지합니다.
** DR 테스트 워크플로우 동안 복제 중단을 방지합니다.
** DR을 넘어 DevTest, 보안 테스트, 패치 또는 업그레이드 테스트, 수정 테스트와 같은 워크플로우를 위해 클라우드 컴퓨팅 리소스를 활용한 DR 데이터의 잠재적 활용.


* CPU 및 RAM을 최적화하여 더 작은 컴퓨팅 클러스터로 복구할 수 있도록 하여 클라우드 비용을 낮추는 데 도움이 됩니다.

